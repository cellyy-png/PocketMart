<view class="container" wx:if="{{cartList.length > 0}}">
  <view class="cart-list">
    <view class="cart-item" wx:for="{{cartList}}" wx:key="cartId">
      <!-- 选择框 -->
      <view class="item-checkbox" bindtap="onSelectItem" data-id="{{item.cartId || item.id}}">
        <icon type="{{utils.includes(selectedIds, (item.cartId || item.id)) ? 'success' : 'circle'}}" color="{{utils.includes(selectedIds, (item.cartId || item.id)) ? '#ff6b6b' : '#ccc'}}" size="22"/>
      </view>
      
      <!-- 商品图 -->
      <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
      
      <!-- 信息区 -->
      <view class="item-detail">
        <view class="item-info-top">
          <view class="item-name">{{item.name}}</view>
          <view class="item-delete" catchtap="onDeleteItem" data-id="{{item.cartId || item.id}}">删除</view>
        </view>
        <view class="item-spec">{{item.spec || '默认规格'}}</view>
        
        <view class="item-bottom">
          <view class="item-price">¥{{item.price}}</view>
          <!-- 数量控制 -->
          <view class="quantity-control">
            <view class="quantity-btn {{item.quantity <= 1 ? 'disabled' : ''}}" 
                  catchtap="onQuantityChange" 
                  data-id="{{item.cartId || item.id}}" 
                  data-type="minus">-</view>
            <view class="quantity-input">{{item.quantity}}</view>
            <view class="quantity-btn" 
                  catchtap="onQuantityChange" 
                  data-id="{{item.cartId || item.id}}" 
                  data-type="plus">+</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部结算栏 -->
  <view class="cart-footer">
    <view class="footer-left" bindtap="onSelectAll">
      <icon type="{{isAllSelected ? 'success' : 'circle'}}" color="{{isAllSelected ? '#ff6b6b' : '#ccc'}}" size="22"/>
      <text class="footer-text">全选</text>
    </view>
    <view class="footer-center">
      <text class="total-label">合计:</text>
      <text class="total-price">¥{{totalPrice}}</text>
    </view>
    <view class="checkout-btn {{selectedIds.length > 0 ? 'active' : ''}}" bindtap="onCheckout">
      结算({{selectedIds.length}})
    </view>
  </view>
</view>

<!-- 空状态 -->
<view class="empty-cart" wx:else>
  <image class="empty-img" src="/assets/images/icons/cart.png" mode="aspectFit" style="opacity: 0.3;"></image>
  <view class="empty-title">购物车竟然是空的</view>
  <view class="empty-sub">再忙，也要记得买点什么犒劳自己~</view>
  <button class="btn-go-shop" bindtap="onGoShopping">去逛逛</button>
</view>

<wxs module="utils">
module.exports.includes = function(arr, item) {
  return arr.indexOf(item) > -1
}
</wxs>