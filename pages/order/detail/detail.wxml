<view class="container" wx:if="{{!loading && order}}">
  <view class="header-status">
    <view class="status-content">
      <view class="status-main">{{order.statusDesc}}</view>
      <view class="status-sub" wx:if="{{order.status == 0}}">Payment required by 15:00 to avoid cancellation</view>
      <view class="status-sub" wx:elif="{{order.status == 2}}">Your order has been shipped</view>
      <view class="status-sub" wx:else>Thank you for shopping with PocketMart</view>
    </view>
  </view>

  <view class="content-wrapper">
    <view class="card-box logistics-card" bindtap="onLogistics" wx:if="{{order.status >= 2}}">
      <view class="icon-truck"></view>
      <view class="card-info">
        <view class="logistics-status">In Transit</view>
        <view class="logistics-desc">Latest tracking info updating...</view>
      </view>
      <view class="arrow-right"></view>
    </view>

    <view class="card-box address-card">
      <view class="icon-location"></view>
      <view class="card-info">
        <view class="user-info">
          <text class="name">{{order.address.name}}</text>
          <text class="phone">{{order.address.phone}}</text>
        </view>
        <view class="address-detail">{{order.address.fullAddress || (order.address.province + order.address.city + order.address.district + order.address.detail)}}</view>
      </view>
    </view>

    <view class="card-box product-card">
      <view class="card-title">ITEMS</view>
      <view class="goods-list">
        <view class="goods-item" wx:for="{{order.products}}" wx:key="id">
          <image class="goods-img" src="{{item.image}}" mode="aspectFill"></image>
          <view class="goods-content">
            <view class="goods-name">{{item.name}}</view>
            <view class="goods-spec">{{item.spec || 'Standard'}}</view>
            <view class="goods-bottom">
              <text class="price">¥{{item.price}}</text>
              <text class="qty">x{{item.quantity}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="card-box info-card">
      <view class="info-row">
        <text class="label">Order ID</text>
        <view class="val-group">
          <text class="val">{{order.id}}</text>
          <view class="btn-copy" bindtap="onCopyNo" data-no="{{order.id}}">COPY</view>
        </view>
      </view>
      <view class="info-row">
        <text class="label">Time</text>
        <text class="val">{{order.createTime}}</text>
      </view>
      <view class="info-row">
        <text class="label">Payment</text>
        <text class="val">Online Payment</text>
      </view>
      <view class="info-row" wx:if="{{order.remark}}">
        <text class="label">Note</text>
        <text class="val">{{order.remark}}</text>
      </view>
    </view>

    <view class="card-box price-card">
      <view class="info-row">
        <text class="label">Subtotal</text>
        <text class="val">¥{{order.productTotal || order.totalPrice}}</text>
      </view>
      <view class="info-row">
        <text class="label">Shipping</text>
        <text class="val">+¥10.00</text>
      </view>
      <view class="info-row">
        <text class="label">Discount</text>
        <text class="val highlight">-¥0.00</text>
      </view>
      <view class="divider"></view>
      <view class="total-row">
        <text class="total-label">Total</text>
        <text class="total-price">¥{{order.totalPrice}}</text>
      </view>
    </view>
  </view>
  
  <view class="footer-spacer"></view>

  <view class="footer-bar">
    <view class="btn-text" bindtap="onContact">Contact Support</view>
    
    <view class="action-group">
      <block wx:if="{{order.status == 0}}">
        <view class="btn-outline" bindtap="onCancel">Cancel</view>
        <view class="btn-primary" bindtap="onPay">Pay Now</view>
      </block>

      <block wx:if="{{order.status == 1}}">
        <view class="btn-outline" bindtap="onRefund" data-type="refund_only">Refund</view>
      </block>
      
      <block wx:if="{{order.status == 2}}">
        <view class="btn-outline" bindtap="onLogistics">Track</view>
        <view class="btn-primary" bindtap="onConfirm">Confirm</view>
      </block>
      
      <block wx:if="{{order.status >= 3}}">
        <view class="btn-outline" bindtap="onDelete">Delete</view>
      </block>
    </view>
  </view>
</view>

<loading wx:if="{{loading}}" text="Loading..." />