<view class="container" wx:if="{{!loading && order}}">
  <view class="header-status">
    <view class="status-text">{{order.statusDesc}}</view>
    <view class="status-desc" wx:if="{{order.status == 0}}">è¯·åœ¨ 15:00 å†…å®Œæˆæ”¯ä»˜ï¼Œè¶…æ—¶å°†è‡ªåŠ¨å–æ¶ˆ</view>
    <view class="status-desc" wx:elif="{{order.status == 2}}">å•†å®¶å·²å‘è´§ï¼Œè¯·ç•™æ„ç‰©æµä¿¡æ¯</view>
    <view class="status-desc" wx:else>æ„Ÿè°¢æ‚¨åœ¨ PocketMart è´­ç‰©</view>
  </view>

  <view class="logistics-card" bindtap="onLogistics" wx:if="{{order.status >= 2}}">
    <view class="logistics-icon">ğŸšš</view>
    <view class="logistics-info">
      <view class="logistics-status">è¿è¾“ä¸­</view>
      <view class="logistics-newest">æœ€æ–°ç‰©æµä¿¡æ¯æ­£åœ¨æ›´æ–°ä¸­...</view>
    </view>
    <view class="arrow">â€º</view>
  </view>

  <view class="address-card">
    <view class="location-icon">ğŸ“</view>
    <view class="address-info">
      <view class="user-row">
        <text class="name">{{order.address.name}}</text>
        <text class="phone">{{order.address.phone}}</text>
      </view>
      <view class="address-text">{{order.address.fullAddress || (order.address.province + order.address.city + order.address.district + order.address.detail)}}</view>
    </view>
  </view>

  <view class="product-card">
    <view class="card-header">
      <text>PocketMart è‡ªè¥</text>
    </view>
    <view class="goods-item" wx:for="{{order.products}}" wx:key="id">
      <image class="goods-img" src="{{item.image}}" mode="aspectFill"></image>
      <view class="goods-info">
        <view class="goods-name">{{item.name}}</view>
        <view class="goods-spec">{{item.spec || 'é»˜è®¤è§„æ ¼'}}</view>
        <view class="goods-price-row">
          <text class="price">Â¥{{item.price}}</text>
          <text class="qty">x{{item.quantity}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="info-card">
    <view class="info-row">
      <text class="label">è®¢å•ç¼–å·</text>
      <view class="value-wrap">
        <text class="value">{{order.id}}</text>
        <text class="copy-btn" bindtap="onCopyNo" data-no="{{order.id}}">å¤åˆ¶</text>
      </view>
    </view>
    <view class="info-row">
      <text class="label">ä¸‹å•æ—¶é—´</text>
      <text class="value">{{order.createTime}}</text>
    </view>
    <view class="info-row">
      <text class="label">æ”¯ä»˜æ–¹å¼</text>
      <text class="value">åœ¨çº¿æ”¯ä»˜</text>
    </view>
    <view class="info-row">
      <text class="label">é…é€æ–¹å¼</text>
      <text class="value">æ™®é€šå¿«é€’</text>
    </view>
    <view class="info-row" wx:if="{{order.remark}}">
      <text class="label">è®¢å•å¤‡æ³¨</text>
      <text class="value">{{order.remark}}</text>
    </view>
  </view>

  <view class="info-card">
    <view class="info-row">
      <text class="label">å•†å“æ€»é¢</text>
      <text class="value">Â¥{{order.productTotal || order.totalPrice}}</text>
    </view>
    <view class="info-row">
      <text class="label">è¿è´¹</text>
      <text class="value">+Â¥10.00</text>
    </view>
    <view class="info-row">
      <text class="label">ä¼˜æƒ </text>
      <text class="value red">-Â¥0.00</text>
    </view>
    <view class="info-row total-row">
      <text class="label bold">å®ä»˜æ¬¾</text>
      <text class="value price-large">Â¥{{order.totalPrice}}</text>
    </view>
  </view>
  
  <view class="footer-placeholder"></view>

  <view class="footer-bar">
    <view class="footer-btn contact" bindtap="onContact">è”ç³»å®¢æœ</view>
    
    <block wx:if="{{order.status == 0}}">
      <view class="footer-btn default" bindtap="onCancel">å–æ¶ˆè®¢å•</view>
      <view class="footer-btn primary" bindtap="onPay">ç«‹å³æ”¯ä»˜</view>
    </block>

    <block wx:if="{{order.status == 1}}">
      <view class="footer-btn default" bindtap="onRefund" data-type="refund_only">ä»…é€€æ¬¾</view>
    </block>
    
    <block wx:if="{{order.status == 2}}">
      <view class="footer-btn default" bindtap="onLogistics">æŸ¥çœ‹ç‰©æµ</view>
      <view class="footer-btn default" bindtap="onRefund" data-type="return_refund">é€€è´§é€€æ¬¾</view>
      <view class="footer-btn primary" bindtap="onConfirm">ç¡®è®¤æ”¶è´§</view>
    </block>
    
    <block wx:if="{{order.status == 3 || order.status == 4 || order.status == 5}}">
      <view class="footer-btn default" bindtap="onDelete">åˆ é™¤è®¢å•</view>
    </block>
  </view>
</view>

<loading wx:if="{{loading}}" text="åŠ è½½è®¢å•è¯¦æƒ…..." />