<view class="container" wx:if="{{products.length > 0}}">
  
  <view class="header-bg"></view>

  <view class="content-wrapper">
    
    <view class="card address-card" bindtap="onAddressSelect">
      <block wx:if="{{address}}">
        <view class="addr-icon-box">
          <view class="icon-location"></view>
        </view>
        <view class="addr-content">
          <view class="user-row">
            <text class="name">{{address.name}}</text>
            <text class="phone">{{address.phone}}</text>
            <text class="tag-default" wx:if="{{address.isDefault}}">Default</text>
          </view>
          <view class="addr-text">
            {{address.province}} {{address.city}} {{address.district}} {{address.detail}}
          </view>
        </view>
        <view class="arrow-right"></view>
      </block>
      
      <view class="no-address" wx:else>
        <view class="add-btn">
          <text class="plus">+</text>
          <text>Add Shipping Address</text>
        </view>
      </view>
    </view>

    <view class="card product-card">
      <view class="card-header">ITEMS ({{products.length}})</view>
      <view class="product-list">
        <view class="product-item" wx:for="{{products}}" wx:key="id">
          <image class="p-thumb" src="{{item.image}}" mode="aspectFill"></image>
          <view class="p-details">
            <view class="p-title">{{item.name}}</view>
            <view class="p-sku">{{item.spec}}</view>
            <view class="p-meta">
              <text class="p-price">¥{{item.price}}</text>
              <text class="p-qty">x{{item.quantity}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="card summary-card">
      <view class="cell-row" bindtap="onCouponSelect">
        <text class="cell-label">Coupon</text>
        <view class="cell-value">
          <text class="coupon-text {{couponDiscount > 0 ? 'highlight' : ''}}">
            {{couponDiscount > 0 ? '- ¥' + couponDiscount : 'Select Coupon'}}
          </text>
          <view class="arrow-right small"></view>
        </view>
      </view>

      <view class="cell-row">
        <text class="cell-label">Note</text>
        <input 
          class="cell-input" 
          placeholder="Optional message to seller" 
          placeholder-class="ph-style"
          bindinput="onRemarkInput" 
        />
      </view>

      <view class="divider"></view>

      <view class="price-row">
        <text class="label">Subtotal</text>
        <text class="value">¥{{productTotal}}</text>
      </view>
      <view class="price-row">
        <text class="label">Shipping</text>
        <text class="value">+ ¥{{shippingFee}}</text>
      </view>
      <view class="price-row" wx:if="{{couponDiscount > 0}}">
        <text class="label">Discount</text>
        <text class="value highlight">- ¥{{couponDiscount}}</text>
      </view>
    </view>

  </view>

  <view class="footer-spacer"></view>
  <view class="footer-bar">
    <view class="total-box">
      <text class="label">Total</text>
      <text class="price">¥{{totalPrice}}</text>
    </view>
    <button 
      class="btn-submit" 
      bindtap="onSubmit" 
      loading="{{submitting}}"
    >
      Place Order
    </button>
  </view>
</view>