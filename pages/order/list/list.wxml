<view class="container">
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === item.key ? 'active' : ''}}" 
      wx:for="{{tabs}}" 
      wx:key="key"
      bindtap="onTabChange"
      data-key="{{item.key}}"
    >
      {{item.name}}
    </view>
  </view>

  <scroll-view class="order-list" scroll-y style="height: calc(100vh - 90rpx);" wx:if="{{orders.length > 0}}">
    <view class="order-card" wx:for="{{orders}}" wx:key="id" bindtap="onOrderDetail" data-id="{{item.id}}">
      <view class="card-header">
        <text class="shop-name">PocketMart 自营</text>
        <text class="status-text {{item.status == 0 ? 'red' : ''}}">{{item.statusDesc || '处理中'}}</text>
      </view>

      <view class="goods-group">
        <view class="goods-item" wx:for="{{item.products}}" wx:key="id" wx:for-item="goods">
          <image class="goods-img" src="{{goods.image}}" mode="aspectFill"></image>
          <view class="goods-info">
            <view class="goods-name">{{goods.name}}</view>
            <view class="goods-spec">{{goods.spec}}</view>
          </view>
          <view class="goods-price-col">
            <view class="price">¥{{goods.price}}</view>
            <view class="qty">x{{goods.quantity}}</view>
          </view>
        </view>
      </view>

      <view class="card-total">
        <text class="total-text">共 {{item.products.length}} 件商品 实付</text>
        <text class="total-price">¥{{item.totalPrice}}</text>
      </view>

      <view class="card-footer">
        <block wx:if="{{item.status == 0}}">
          <button class="btn plain" catchtap="onCancelOrder" data-id="{{item.id}}">取消订单</button>
          <button class="btn primary" catchtap="onPayOrder" data-id="{{item.id}}">去支付</button>
        </block>

        <block wx:if="{{item.status == 1}}">
           <button class="btn plain" catchtap="onRefund" data-id="{{item.id}}" data-type="refund_only">仅退款</button>
        </block>

        <block wx:if="{{item.status == 2}}">
           <button class="btn plain" catchtap="onRefund" data-id="{{item.id}}" data-type="return_refund">退货退款</button>
           <button class="btn primary" catchtap="onConfirmReceipt" data-id="{{item.id}}">确认收货</button>
        </block>
      </view>
    </view>
    
    <view class="footer-tip">没有更多了</view>
  </scroll-view>

  <view class="empty-state" wx:else>
    <image class="empty-icon" src="/assets/images/icons/cart.png" />
    <text>暂无相关订单</text>
  </view>
</view>