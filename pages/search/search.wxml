<!--pages/search/search.wxml-->
<view class="container">
  <!-- 搜索栏 -->
  <view class="search-header">
    <view class="search-bar-wrapper">
      <icon type="search" size="16" class="search-icon" />
      <input 
        class="search-input" 
        placeholder="请输入商品名称" 
        value="{{keyword}}" 
        bindinput="onSearchInput"
        bindconfirm="onSearch"
        focus="{{true}}"
      />
      <icon 
        wx:if="{{keyword}}" 
        type="clear" 
        size="16" 
        class="clear-icon" 
        bindtap="onClearKeyword"
      />
    </view>
    <text class="cancel-btn" bindtap="onCancel">取消</text>
  </view>

  <!-- 热门搜索和历史记录 -->
  <view wx:if="{{!showResult}}" class="search-content">
    <!-- 热门搜索 -->
    <view class="hot-search">
      <view class="section-title">热门搜索</view>
      <view class="keyword-list">
        <view 
          wx:for="{{hotKeywords}}" 
          wx:key="index"
          class="keyword-item"
          bindtap="onSearch"
          data-keyword="{{item}}"
        >
          <text class="keyword-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 搜索历史 -->
    <view class="search-history" wx:if="{{searchHistory.length > 0}}">
      <view class="history-header">
        <text class="section-title">搜索历史</text>
        <text class="clear-history" bindtap="onClearHistory">清空</text>
      </view>
      <view class="keyword-list">
        <view 
          wx:for="{{searchHistory}}" 
          wx:key="index"
          class="keyword-item history-item"
          bindtap="onSearch"
          data-keyword="{{item}}"
        >
          <text class="keyword-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 搜索结果 -->
  <view wx:else class="result-content">
    <!-- 商品列表 -->
    <scroll-view scroll-y class="product-list">
      <!-- 这里直接手动渲染简单的商品卡片结构，或者使用组件 -->
      <view class="product-item" wx:for="{{products}}" wx:key="id" bindtap="onProductTap" data-id="{{item.id}}">
        <image class="p-img" src="{{item.image}}" mode="aspectFill"></image>
        <view class="p-info">
          <view class="p-name">{{item.name}}</view>
          <view class="p-price-row">
            <text class="price-symbol">¥</text>
            <text class="price-num">{{item.price}}</text>
            <text class="sales">已售{{item.sales}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- 加载更多 -->
    <loading wx:if="{{loading}}" />

    <!-- 没有更多数据 -->
    <view wx:elif="{{!hasMore && products.length > 0}}" class="no-more">
      没有更多商品了
    </view>

    <!-- 空状态 -->
    <empty-state 
      wx:if="{{!loading && products.length === 0}}" 
      icon="search" 
      text="暂无相关商品" 
    />
  </view>
</view>