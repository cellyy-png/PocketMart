<view class="container" wx:if="{{!loading}}">
  <!-- 商品轮播 -->
  <swiper class="gallery" indicator-dots autoplay circular>
    <swiper-item wx:for="{{product.images}}" wx:key="*this">
      <image src="{{item}}" mode="aspectFill" class="gallery-img" />
    </swiper-item>
  </swiper>

  <!-- 基本信息 -->
  <view class="info-card">
    <view class="price-row">
      <text class="symbol">¥</text>
      <text class="price">{{product.price}}</text>
      <text class="original">¥{{product.originalPrice}}</text>
    </view>
    <view class="title">{{product.name}}</view>
    <view class="desc">{{product.desc}}</view>
  </view>

  <!-- 规格选择入口 -->
  <view class="cell-group" bindtap="openSku" data-mode="cart">
    <view class="cell">
      <text class="label">选择</text>
      <text class="value">{{specText}}</text>
      <text class="arrow">›</text>
    </view>
  </view>

  <!-- 详情内容 -->
  <view class="detail-content">
    <view class="section-title">商品详情</view>
    <rich-text nodes="{{product.detailHtml}}"></rich-text>
  </view>

  <!-- 底部操作栏 -->
  <view class="footer-bar">
    <view class="icons">
      <view class="icon-btn" bindtap="toHome">
        <image src="/assets/images/icons/home.png" />
        <text>首页</text>
      </view>
      <view class="icon-btn" bindtap="toCart">
        <image src="/assets/images/icons/cart.png" />
        <text>购物车</text>
      </view>
    </view>
    <view class="btns">
      <view class="btn yellow" bindtap="openSku" data-mode="cart">加入购物车</view>
      <view class="btn red" bindtap="openSku" data-mode="buy">立即购买</view>
    </view>
  </view>

  <!-- SKU弹窗 -->
  <view class="sku-modal {{showSku ? 'show' : ''}}">
    <view class="mask" bindtap="closeSku"></view>
    <view class="content">
      <view class="sku-header">
        <image src="{{product.image}}" mode="aspectFill"></image>
        <view class="sku-info">
          <view class="sku-price">¥{{product.price}}</view>
          <view class="sku-selected">已选: {{quantity}}件</view>
        </view>
        <view class="close" bindtap="closeSku">×</view>
      </view>

      <scroll-view scroll-y class="sku-body">
        <view class="spec-group" wx:for="{{product.specs}}" wx:key="name">
          <view class="spec-title">{{item.name}}</view>
          <view class="spec-list">
            <view 
              class="spec-item {{selectedSpecs[item.name] == subItem ? 'active' : ''}}" 
              wx:for="{{item.list}}" 
              wx:key="*this"
              wx:for-item="subItem"
              bindtap="selectSpec"
              data-key="{{item.name}}"
              data-value="{{subItem}}"
            >
              {{subItem}}
            </view>
          </view>
        </view>

        <view class="qty-row">
          <text>购买数量</text>
          <view class="stepper">
            <view class="minus {{quantity<=1?'disabled':''}}" bindtap="onQtyChange" data-type="minus">-</view>
            <view class="num">{{quantity}}</view>
            <view class="plus" bindtap="onQtyChange" data-type="plus">+</view>
          </view>
        </view>
      </scroll-view>

      <view class="sku-footer">
        <view class="confirm-btn" bindtap="confirmSku">确定</view>
      </view>
    </view>
  </view>
</view>

<loading wx:if="{{loading}}" text="加载详情..." />