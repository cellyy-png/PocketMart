<view class="container" wx:if="{{!loading}}">
  <swiper 
    class="product-swiper" 
    indicator-dots="{{true}}" 
    autoplay="{{true}}" 
    interval="5000" 
    duration="500"
    indicator-active-color="#ff6b6b"
    bindchange="onImageChange"
  >
    <swiper-item wx:for="{{product.images}}" wx:key="*this" bindtap="onImagePreview">
      <image class="swiper-image" src="{{item}}" mode="aspectFill" />
    </swiper-item>
  </swiper>

  <view class="product-info-card">
    <view class="price-row">
      <view class="current-price">
        <text class="symbol">Â¥</text>
        <text class="num">{{product.price}}</text>
      </view>
      <text class="original-price" wx:if="{{product.originalPrice}}">Â¥{{product.originalPrice}}</text>
      <view class="sales-info">å·²å”® {{product.sales}}</view>
    </view>
    
    <view class="product-title">{{product.name}}</view>
    <view class="product-desc">{{product.desc}}</view>
  </view>

  <view class="spec-section" wx:if="{{product.specs.length > 0}}">
    <view class="spec-row" wx:for="{{product.specs}}" wx:key="name" wx:for-item="spec">
      <view class="spec-label">{{spec.name}}</view>
      <view class="spec-values">
        <view 
          class="spec-item {{selectedSpec[spec.name] === item ? 'active' : ''}}" 
          wx:for="{{spec.values}}" 
          wx:key="*this"
          data-name="{{spec.name}}"
          data-value="{{item}}"
          bindtap="onSpecTap"
        >
          {{item}}
        </view>
      </view>
    </view>
    
    <view class="quantity-row">
      <view class="spec-label">æ•°é‡</view>
      <view class="quantity-control">
        <view class="qty-btn {{quantity <= 1 ? 'disabled' : ''}}" bindtap="onQuantityChange" data-type="minus">-</view>
        <view class="qty-num">{{quantity}}</view>
        <view class="qty-btn" bindtap="onQuantityChange" data-type="plus">+</view>
      </view>
    </view>
  </view>

  <view class="detail-section">
    <view class="section-title">å•†å“è¯¦æƒ…</view>
    <view class="detail-content">
      <rich-text nodes="{{product.detail}}"></rich-text>
    </view>
  </view>

  <view class="bottom-barsafe-area">
    <view class="bottom-bar">
      <view class="action-icons">
        <view class="icon-item" bindtap="onContactService">
          <text class="icon-text">ğŸ§</text>
          <text class="icon-label">å®¢æœ</text>
        </view>
        <navigator class="icon-item" url="/pages/cart/cart" open-type="switchTab">
          <text class="icon-text">ğŸ›’</text>
          <text class="icon-label">è´­ç‰©è½¦</text>
        </navigator>
        <view class="icon-item" bindtap="onFavoriteTap">
          <text class="icon-text" style="color: {{isFavorite ? '#ff6b6b' : '#333'}}">{{isFavorite ? 'â™¥' : 'â™¡'}}</text>
          <text class="icon-label">æ”¶è—</text>
        </view>
      </view>
      
      <view class="action-buttons">
        <view class="btn-cart" bindtap="onAddToCart">åŠ å…¥è´­ç‰©è½¦</view>
        <view class="btn-buy" bindtap="onBuyNow">ç«‹å³è´­ä¹°</view>
      </view>
    </view>
  </view>
</view>

<loading wx:else />